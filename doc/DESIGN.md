# 基本設計
## モジュール構成

```
  crate
   |
   +- cmd_args - コマンドライン引数処理モジュール
   |   |
   |   +- config - config.toml取り扱いモジュール
   |
   +- command - サブコマンド定義モジュール
   |   |
   |   +- matcher - Matcher列挙子定義を行うモジュール(共用モジュール)
   |   +- prompt - Promptトレイト定義を行うモジュール(共用モジュール)
   |   |
   |   +- add - addサブコマンド定義モジュール
   |   +- edit - editサブコマンド定義モジュール
   |   +- export - exportサブコマンド定義モジュール
   |   +- import - importサブコマンド定義モジュール
   |   +- list - listサブコマンド定義モジュール
   |   +- tags - tagsサブコマンド定義モジュール
   |   +- query - queryサブコマンド定義モジュール
   |   +- search - searchサブコマンド定義モジュール
   |
   +- database - データベース操作モジュール
       |
       +- types - データ型定義モジュール 

```

## データベース設計
データベースにはredbを用いる。データベース内には以下のテーブるを設ける。

| テーブル名 | キー | 値 |概要
|:---|:---
| entries | サービスID | エントリ情報 |サービスエントリを登録するテーブル
| tags | タグ文字列 | サービスID | タグとサービスIDの対応を保持するマルチマップテーブル |

### テーブル間の関係と整合性保持の指針

- `entries.tags` に記録されたタグと、`tags` テーブルの対応が常に一致するようにする。
- 追加/新規登録: `entries` への書き込みと同じトランザクションで、付与された各タグに対して `tags` に (tag, service_id) を追加する。
- 更新: 旧タグ集合と新タグ集合の差分を取り、削除されたタグは `tags` から対応を削除、新規タグは追加する。
- 削除: `entries` からエントリを削除するのと同じトランザクションで、そのエントリに紐づく全タグの対応を `tags` から削除する。
- 上記の整合更新は必ず1トランザクション内で完結させ、両テーブルに不整合が残らないようにする。


